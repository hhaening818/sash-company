<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹œê³µ ì‚¬ë¡€</title>

<style>

body{
    font-family:'Noto Sans KR',sans-serif;
    background:#f1f5f9;
    margin:0;
}

/* ìƒë‹¨ */
.header{
    background:white;
    padding:20px 30px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

.header h1{
    margin:0;
}

.upload-box input{
    margin-right:10px;
}

/* ê°¤ëŸ¬ë¦¬ */
.gallery{
    max-width:1200px;
    margin:30px auto;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:20px;
}

.card{
    background:white;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
    transition:0.3s;
    padding:0;
}

.card:hover{
    transform:translateY(-5px);
}

.card img{
    width:100%;
    height:220px;
    object-fit:cover;
    cursor:pointer;
    display:block;
}

.card .actions{
    padding:10px;
    text-align:right;
}

.delete-btn{
    background:#ef4444;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:8px;
    cursor:pointer;
}

.delete-btn:hover{
    background:#dc2626;
}

/* í™•ëŒ€ ëª¨ë‹¬ */
.modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);
    justify-content:center;
    align-items:center;
}

.modal img{
    max-width:90%;
    max-height:90%;
}

.back-btn{

    position:absolute;
    top:20px;
    left:20px;

    z-index:10000;

    background:#0f172a;
    color:white;

    border:none;
    padding:10px 16px;

    border-radius:8px;

    font-size:14px;
    cursor:pointer;

}

.back-btn:hover{
    background:#1e293b;
}

</style>

</head>
<body>


<div class="header">

<h1>ğŸ›  ì‹œê³µ ì‚¬ë¡€</h1>

{% if is_admin %}

<div class="upload-box">

<form id="uploadForm" enctype="multipart/form-data">

<div id="dropArea"
     style="
     border:2px dashed #94a3b8;
     padding:30px;
     border-radius:12px;
     text-align:center;
     background:white;
     cursor:pointer;">

ğŸ“ ì—¬ê¸°ì— ì‚¬ì§„ ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­

<input type="file"
       name="image"
       id="fileInput"
       multiple
       style="display:none">

</div>

<br>

<button type="submit">
ì—…ë¡œë“œ
</button>

</form>

<!-- progress bar -->
<div style="margin-top:15px;background:#e5e7eb;border-radius:10px;overflow:hidden;">

<div id="progressBar"
     style="
     width:0%;
     height:20px;
     background:#3b82f6;
     transition:0.3s;">
</div>

</div>

<div id="progressText"></div>

</div>

{% endif %}


</div>


<div class="gallery">

{% for id, img in images %}

<div class="card">

<img src="{{ img.replace('/upload/','/upload/w_600,q_auto,f_auto/') }}"
     onclick="openModal('{{ img.replace('/upload/','/upload/w_1600,q_auto,f_auto/') }}')">


{% if is_admin %}
<div class="actions">

<form action="/admin/delete_portfolio/{{ id }}"
      method="POST">

<button class="delete-btn">
ì‚­ì œ
</button>

</form>

</div>
{% endif %}

</div>

{% endfor %}

</div>


<div class="modal" id="modal">

<button class="back-btn"
        onclick="event.stopPropagation(); closeModal();">
    â† ë’¤ë¡œê°€ê¸°
</button>

<img id="modalImg"
     onclick="event.stopPropagation()">

</div>


<script>

function openModal(src){

    document.getElementById("modalImg").src = src;
    document.getElementById("modal").style.display="flex";

}

function closeModal(){

    document.getElementById("modal").style.display="none";

}

</script>

<script>

const dropArea = document.getElementById("dropArea");
const fileInput = document.getElementById("fileInput");
const form = document.getElementById("uploadForm");

const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");


// ë“œë˜ê·¸
if(dropArea){

    dropArea.onclick = () => fileInput.click();

    dropArea.addEventListener("dragover", e => {
        e.preventDefault();
        dropArea.style.background="#e0f2fe";
    });

    dropArea.addEventListener("dragleave", () => {
        dropArea.style.background="white";
    });

    dropArea.addEventListener("drop", e => {

        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        dropArea.style.background="white";

    });

}


// ì—…ë¡œë“œ + progress
if(form){

form.addEventListener("submit", function(e){

    e.preventDefault();

    const files = fileInput.files;

    if(files.length === 0){
        alert("íŒŒì¼ ì„ íƒí•˜ì„¸ìš”");
        return;
    }

    let uploaded = 0;

    for(let file of files){

        let formData = new FormData();
        formData.append("image", file);

        let xhr = new XMLHttpRequest();

        xhr.open("POST","/admin/upload_portfolio",true);

        xhr.upload.onprogress = function(e){

            if(e.lengthComputable){

                let percent =
                Math.round((uploaded/files.length)*100
                + (e.loaded/e.total)*(100/files.length));

                progressBar.style.width = percent + "%";
                progressText.innerText = percent + "% ì—…ë¡œë“œ ì¤‘";

            }

        };

        xhr.onload = function(){

            uploaded++;

            if(uploaded === files.length){

                progressBar.style.width = "100%";
                progressText.innerText = "ì—…ë¡œë“œ ì™„ë£Œ";

                setTimeout(()=>{
                    location.reload();
                },800);

            }

        };

        xhr.send(formData);

    }

});

}

</script>


</body>
</html>
