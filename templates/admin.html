<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì í˜ì´ì§€</title>
<canvas id="monthlyChart"></canvas>
<th>ì‚¬ì§„</th>


<style>
body { 
    font-family: Arial; 
    background:#f4f4f4; 
    padding:20px; 
    margin:0;
}

.top-bar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.logout-btn {
    background:#1e293b;
    color:white;
    padding:8px 18px;
    border-radius:20px;
    text-decoration:none;
    font-weight:500;
}

.logout-btn:hover {
    background:#334155;
}

/* ê¸°ë³¸ í…Œì´ë¸” */
table { 
    width:70%;              /* â† 100% â†’ 70%ë¡œ ë³€ê²½ */
    margin:20px auto;       /* ê°€ìš´ë° ì •ë ¬ */
    border-collapse:collapse; 
    background:white; 
    font-size:13px;         /* ê¸€ì ì¡°ê¸ˆ ì¤„ì´ê¸° */
}


th, td { 
    padding:6px 8px;        /* ì—¬ë°± ì¤„ì´ê¸° */
    border:1px solid #ddd; 
    text-align:center; 
    font-size:13px;
}


th { 
    background:#1e3a8a; 
    color:white; 
}

a.call { 
    color:green; 
    font-weight:bold; 
    text-decoration:none; 
}

a.delete { 
    color:red; 
    font-weight:bold;
    text-decoration:none; 
}

/* ========================= */
/* ğŸ“± ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
/* ========================= */

@media (max-width: 768px) {

    body {
        padding:10px;
    }

    table, thead, tbody, th, td, tr {
        display:block;
    }

    thead {
        display:none;
    }

    tr {
        background:white;
        margin-bottom:15px;
        padding:10px;
        border-radius:10px;
        box-shadow:0 3px 10px rgba(0,0,0,0.08);
    }

    td {
        border:none;
        text-align:left;
        padding:6px 0;
        font-size:14px;
    }

    td::before {
        font-weight:bold;
        display:block;
        color:#1e3a8a;
    }

    td:nth-of-type(1)::before { content:"ì´ë¦„"; }
    td:nth-of-type(2)::before { content:"ì „í™”ë²ˆí˜¸"; }
    td:nth-of-type(3)::before { content:"ë‚´ìš©"; }
    td:nth-of-type(4)::before { content:"ì‹œê°„"; }
    td:nth-of-type(5)::before { content:"ê´€ë¦¬"; }

    a.call {
        display:inline-block;
        background:#22c55e;
        color:white;
        padding:6px 10px;
        border-radius:6px;
        margin-top:4px;
    }

    a.delete {
        display:inline-block;
        background:#ef4444;
        color:white;
        padding:6px 10px;
        border-radius:6px;
        margin-top:4px;
    }
}

.stats {
    display:flex;
    gap:20px;
    margin-bottom:20px;
}

.card {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
    text-align:center;
}
.card h3 {
    margin:0;
    font-size:16px;
}
.card p {
    font-size:24px;
    font-weight:bold;
    margin:10px 0 0;
}
.chart-box {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
    margin-bottom:20px;
}

</style>
</head>

<body>

<div class="top-bar">
    <h1>ğŸ“‹ ë¬¸ì˜ ëª©ë¡</h1>
    <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
</div>

<div class="stats">
    <div class="card">
        <h3>ğŸ“… ì˜¤ëŠ˜ ë¬¸ì˜</h3>
        <p>{{ today_count }} ê±´</p>
    </div>
</div>

<div class="chart-box">
    <canvas id="monthlyChart"></canvas>
</div>

<table>
<tr>
<th>ì´ë¦„</th>
<th>ì „í™”ë²ˆí˜¸</th>
<th>ë‚´ìš©</th>
<th>ì‹œê°„</th>
<th>ê´€ë¦¬</th>
</tr>

{% for i in inquiries %}
<tr>
    <td>{{ i[1] }}</td>

    <td>
        <a class="call" href="tel:{{ i[2] }}">
            {{ i[2] }}
        </a>
    </td>

    <td>{{ i[3] }}</td>

    <td>
         {% if i[4] %}
             <a href="{{ i[4] }}" target="_blank">
                 <img src="{{ i[4] }}"
                     width="80"
                     style="border-radius:8px; cursor:pointer;">
             </a>
         {% else %}
              -
         {% endif %}
     </td>



    <td>
         {{ i[5].strftime('%Y-%m-%d %H:%M') if i[5] else '-' }}
    </td>



    <td>
        <form action="/delete/{{ i[0] }}" method="POST" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="delete">ì‚­ì œ</button>
        </form>
    </td>
</tr>
{% endfor %}

</table>

<div id="chart-data"
     data-months='{{ months | tojson | safe }}'
     data-counts='{{ counts | tojson | safe }}'
     style="display:none;">
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const chartDataEl = document.getElementById("chart-data");

if (chartDataEl) {
    const months = JSON.parse(chartDataEl.dataset.months);
    const counts = JSON.parse(chartDataEl.dataset.counts);

    const ctx = document.getElementById("monthlyChart");

    if (ctx) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'ì›”ë³„ ë¬¸ì˜ ìˆ˜',
                    data: counts,
                    backgroundColor: '#1e3a8a'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
}
</script>


</body>
</html>
