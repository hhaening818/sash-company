<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì í˜ì´ì§€</title>

<style>
:root{
    --bg:#0f172a;
    --card:#1e293b;
    --card-light:#334155;
    --text:#f1f5f9;
    --sub:#e4f5e6eb;
    --accent:#3b82f6;
    --danger:#ef4444;
    --warning:#f59e0b;
    --border:#334155;
}

/* =========================
   ì „ì²´ ê¸°ë³¸
========================= */
body{
    margin:0;
    font-family:'Noto Sans KR',sans-serif;
    background:var(--bg);
    color:var(--text);
}

/* =========================
   ìƒë‹¨ í—¤ë”
========================= */
.top-section{
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px 40px;
    background:var(--card);
    border-bottom:1px solid var(--border);
}

.top-section h1{
    margin:0;
    font-size:22px;
    font-weight:600;
}

.sub{
    color:var(--sub);
    font-size:13px;
    margin-top:4px;
}

/* =========================
   ë²„íŠ¼ ê³µí†µ
========================= */
button,
.logout-btn,
.export-btn,
.reply-btn,
.delete-btn,
.edit-btn{
    border:none;
    padding:8px 16px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
    text-decoration:none;
    color:white;
    transition:0.2s;
}

button:hover,
.logout-btn:hover,
.export-btn:hover,
.reply-btn:hover,
.delete-btn:hover,
.edit-btn:hover{
    opacity:0.85;
}

.logout-btn,
.export-btn,
.reply-btn{
    background:var(--accent);
}

.delete-btn{
    background:var(--danger);
}

.edit-btn{
    background:var(--warning);
    font-size:12px;
    padding:5px 10px;
}

/* =========================
   í†µê³„ ì¹´ë“œ
========================= */
.stats{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:30px;
    flex-wrap:wrap;
}

.stat-card{
    background:var(--card);
    padding:20px;
    width:170px;
    border-radius:12px;
    text-align:center;
    border:1px solid var(--border);
}

.stat-card:hover{
    background:var(--card-light);
}

.stat-card .number{
    font-size:26px;
    font-weight:bold;
    margin-top:6px;
    color:var(--accent);
}

/* =========================
   ì°¨íŠ¸ ì˜ì—­
========================= */
.chart-wrapper{
    width:95%;
    margin:0 auto 15px auto;
    display:flex;
    align-items:center;
    gap:10px;
}

.chart-box{
    width:100%;
    background:var(--card);
    padding:20px;
    border-radius:12px;
    border:1px solid var(--border);
}

/* =========================
   í…Œì´ë¸”
========================= */
.admin-table{
    width:95%;
    margin:0 auto 40px auto;
    border-collapse:collapse;
    background:var(--card);
    border-radius:12px;
    overflow:hidden;
    table-layout:fixed;
}

.admin-table th{
    background:var(--card-light);
    padding:14px;
    font-size:14px;
    text-align:center;
}

.admin-table td{
    padding:14px;
    border-bottom:1px solid var(--border);
    font-size:14px;
    text-align:center;
    vertical-align:middle;
}

.admin-table tr:hover{
    background:#243041;
}

/* ì»¬ëŸ¼ ë„ˆë¹„ ê³ ì • */
.admin-table th:nth-child(1),
.admin-table td:nth-child(1){width:10%;}

.admin-table th:nth-child(2),
.admin-table td:nth-child(2){width:15%;}

.admin-table th:nth-child(3),
.admin-table td:nth-child(3){width:20%;}

.admin-table th:nth-child(4),
.admin-table td:nth-child(4){width:10%;}

.admin-table th:nth-child(5),
.admin-table td:nth-child(5){width:15%;}

.admin-table th:nth-child(6),
.admin-table td:nth-child(6){width:15%;}

.admin-table th:nth-child(7),
.admin-table td:nth-child(7){width:15%;}

/* =========================
   ì „í™”ë²ˆí˜¸
========================= */
.phone{
    color:var(--accent);
    text-decoration:none;
}

/* =========================
   ì´ë¯¸ì§€
========================= */
.thumb{
    width:60px;
    height:60px;
    object-fit:cover;
    border-radius:8px;
}

/* =========================
   ì…ë ¥ì°½
========================= */
input, select{
    background:var(--bg);
    border:1px solid var(--border);
    color:var(--text);
    padding:6px;
    border-radius:6px;
}

/* =========================
   ê´€ë¦¬ ë²„íŠ¼ ê·¸ë£¹
========================= */
.action-group{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
}

.reply-box{
    width:180px;
}

.reply-text{
    background:var(--card-light);
    padding:6px 10px;
    border-radius:6px;
    font-size:13px;
}

/* =========================
   íŒŒì¼ ë²„íŠ¼
========================= */
.file-btn{
    background:var(--card-light);
    padding:6px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
    border:1px solid var(--border);
}

.file-btn:hover{
    background:var(--accent);
}

.file-btn input{
    display:none;
}

/* =========================
   íŒì—…
========================= */
.popup{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
}

.popup-content{
    background:var(--card);
    padding:20px;
    border-radius:12px;
    width:320px;
    border:1px solid var(--border);
}

/* =========================
   ëª¨ë‹¬
========================= */
.modal{
    display:none;

    position:fixed;
    top:0;
    left:0;

    width:100%;
    height:100%;

    background:rgba(0,0,0,0.7);

    z-index:9999;

    /* ì¤‘ì•™ ì •ë ¬ í•µì‹¬ */
    display:flex;
    justify-content:center;
    align-items:center;
}

.modal-content{

    background:var(--card);

    padding:25px;

    border-radius:12px;

    width:400px;
    max-width:90%;

    border:1px solid var(--border);

    position:relative;

}

/* =========================
   ì´ë¯¸ì§€ ì „ì²´ ë³´ê¸°
========================= */
.image-viewer{
    display:none;
    position:fixed;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);
    justify-content:center;
    align-items:center;
}

.image-viewer img{
    max-width:90%;
    max-height:90%;
}

/* =========================
    ì›”ë³„ í†µê³„ ë³´ê¸° ë²„íŠ¼
========================= */
.toggle-btn{
    background:#1e40af;
    color:white;
    font-weight:600;
}

.toggle-btn:hover{
    background:#1d4ed8;
}

/* =========================
ìƒíƒœ ë³€ê²½ ë²„íŠ¼
========================= */
.admin-table form button{
    background:#1e40af;
    color:white;
    font-weight:600;
}

.admin-table form button:hover{
    background:#1d4ed8;
}

/* =========================
   ë‹µë³€ í™•ì¸ íŒì—… (ê³ ê¸‰ UI)
========================= */

.reply-view-popup{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    backdrop-filter:blur(4px);
    justify-content:center;
    align-items:center;
    z-index:9999;
}

.reply-view-box{

    background:linear-gradient(180deg,#1e293b,#0f172a);

    border:1px solid var(--border);

    border-radius:16px;

    width:420px;

    max-width:90%;

    padding:25px;

    box-shadow:0 20px 50px rgba(0,0,0,0.6);

    animation:popupFade 0.25s ease;
}

@keyframes popupFade{
    from{
        opacity:0;
        transform:translateY(20px) scale(0.95);
    }
    to{
        opacity:1;
        transform:translateY(0) scale(1);
    }
}

.reply-view-title{

    font-size:18px;
    font-weight:600;

    margin-bottom:15px;

    border-bottom:1px solid var(--border);

    padding-bottom:8px;
}

.reply-view-content{

    background:#0f172a;

    padding:12px;

    border-radius:8px;

    border:1px solid var(--border);

    margin-bottom:15px;

    font-size:14px;

    white-space:pre-wrap;
}

.reply-view-file{

    margin-bottom:15px;
}

.reply-view-buttons{

    display:flex;

    justify-content:flex-end;

    gap:10px;
}

.reply-view-buttons button{

    padding:8px 16px;

    border-radius:8px;

    font-weight:500;
}

/* =========================
   ì™„ë£Œ ìƒ‰ìƒ (ì´ˆë¡ìƒ‰ í†µì¼)
========================= */

/* ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
.export-btn{
    background:#10b981 !important;
    color:white;
    font-weight:600;
}

.export-btn:hover{
    background:#059669 !important;
}

/* ë‹µë³€ í™•ì¸ ë²„íŠ¼ */
.reply-box .reply-btn{
    background:#10b981 !important;
    color:white;
    font-weight:600;
}

.reply-box .reply-btn:hover{
    background:#059669 !important;
}

/* =========================
   ì‚­ì œ ë²„íŠ¼ (ë¹¨ê°„ìƒ‰ ê°•ì¡°)
========================= */

.delete-btn{
    background:#ef4444 !important;
    color:white;
    font-weight:600;
}

.delete-btn:hover{
    background:#dc2626 !important;
}

/* =========================
   ê´€ë¦¬ ë²„íŠ¼ ë™ì¼ í¬ê¸°
========================= */

.reply-box .reply-btn,
.reply-box .edit-btn,
.action-group .delete-btn{

    width:110px;
    height:36px;

    display:inline-flex;
    align-items:center;
    justify-content:center;

    font-size:13px;
    font-weight:600;

    border-radius:8px;
}

/* ë²„íŠ¼ ê°„ê²© */
.reply-box,
.action-group{
    gap:6px;
}

.close{

    cursor:pointer;

    font-size:24px;

    transition:0.2s;

}

.close:hover{

    color:#60a5fa;

    transform:scale(1.1);

}

</style>

</head>

<body>

<div class="top-section">

    <div>
        <h1>ğŸ“‹ ë¬¸ì˜ ê´€ë¦¬</h1>
        <p class="sub">ìµœê·¼ ì ‘ìˆ˜ëœ ë¬¸ì˜ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
    </div>

    <div>
        <a href="/" class="logout-btn" style="margin-right:10px;">
            ğŸ  ì›¹ì‚¬ì´íŠ¸ë¡œ ëŒì•„ê°€ê¸°
        </a>

        <a href="/logout" class="logout-btn">
            ë¡œê·¸ì•„ì›ƒ
        </a>
    </div>

</div>

<div class="stats">

    <div class="stat-card">
        <div>ğŸ“¬ ì „ì²´ ë¬¸ì˜</div>
        <div class="number">{{ total_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“… ì˜¤ëŠ˜ ë¬¸ì˜</div>
        <div class="number">{{ today_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“Š ì´ë²ˆë‹¬ ë¬¸ì˜</div>
        <div class="number">{{ month_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“¸ ì‚¬ì§„ í¬í•¨</div>
        <div class="number">{{ image_count }}</div>
    </div>

</div>

<div class="chart-wrapper">
    <button class="toggle-btn" onclick="toggleChart()">
        ğŸ“Š ì›”ë³„ í†µê³„ ë³´ê¸°
    </button>

    <div id="chartArea" class="chart-box" style="display:none;">
        <canvas id="monthlyChart"></canvas>
    </div>
    <a href="/export" class="export-btn">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
</div>

<table class="admin-table">

    <thead>
        <tr>
            <th>ì´ë¦„</th>
            <th>ì „í™”ë²ˆí˜¸</th>
            <th>ë‚´ìš©</th>
            <th>ì‚¬ì§„</th>
            <th>ìƒíƒœ</th>
            <th>ì‹œê°„</th>
            <th>ê´€ë¦¬</th>
        </tr>
    </thead>

    <tbody>

        {% for i in inquiries %}

        <tr onclick="if(event.target.closest('.reply-btn') || event.target.closest('.action-group')) return; showDetail(
            '{{ i[1] }}',
            '{{ i[2] }}',
            `{{ i[3] }}`,
            '{{ i[4] }}',
            '{{ i[5] }}'
        )">

            <td>
                {{ i[1] }}
            </td>

            <td>
                <a href="tel:{{ i[2] }}" class="phone">
                    {{ i[2] }}
                </a>
            </td>

            <td class="message">
                {{ i[3] }}
            </td>

            <td>

                {% if i[5] %}

                    {% set file_url = i[5].replace('/upload/', '/upload/f_auto,q_auto,w_200/') %}

                    <a href="{{ file_url }}" target="_blank">
                        <img src="{{ file_url }}"
                             style="width:60px;height:60px;object-fit:cover;border-radius:6px;">
                    </a>

                {% else %}

                    -

                {% endif %}

            </td>

            <td onclick="event.stopPropagation()">

                <div>

                    {% if i[6] == "ëŒ€ê¸°" %}
                        <span style="color:#ef4444;font-weight:bold;">â— ëŒ€ê¸°</span>
                    {% else %}
                        <span style="color:#10b981;font-weight:bold;">â— ì™„ë£Œ</span>
                    {% endif %}

                </div>

                <form action="/admin/update_status/{{ i[0] }}"
                      method="POST"
                      style="margin-top:6px;">

                    <select name="status"
                            onclick="event.stopPropagation()">

                        <option value="ëŒ€ê¸°"
                        {% if i[6] == "ëŒ€ê¸°" %}selected{% endif %}>
                            â— ëŒ€ê¸°
                        </option>

                        <option value="ì™„ë£Œ"
                        {% if i[6] == "ì™„ë£Œ" %}selected{% endif %}>
                            â— ì™„ë£Œ
                        </option>

                    </select>

                    <button type="submit">
                        ë³€ê²½
                    </button>

                </form>

            </td>

            <td class="time">
                {{ i[4] }}
            </td>

            <td onclick="event.stopPropagation()">

                <div class="action-group" onclick="event.stopPropagation()">

                    {% if i[7] %}

                        <div class="reply-box">

                            <button type="button"
                                onclick="event.stopPropagation(); openReplyViewPopup(
                                    '{{ i[0] }}',
                                    `{{ i[3]|escape }}`,
                                    `{{ i[7]|escape }}`,
                                    '{{ i[8] }}'
                                )"
                                class="reply-btn">
                                ë‹µë³€ í™•ì¸
                            </button>

                            {% if i[8] %}

                                <div class="file-preview">

                                    <a href="{{ i[8] }}"
                                       target="_blank"
                                       class="download-btn">

                                        ğŸ“ {{ i[8].split('/')[-1].split('?')[0] }}

                                    </a>

                                </div>

                            {% endif %}

                        </div>

                    {% else %}

                        <button type="button"
                                onclick="openReplyPopup('{{ i[0] }}','')"
                                class="reply-btn">
                            ë‹µë³€
                        </button>

                    {% endif %}

                    <form onsubmit="event.preventDefault(); deleteInquiry('{{ i[0] }}', this);">

                        <input type="hidden"
                               name="csrf_token"
                               value="{{ csrf_token() }}">

                        <button type="submit"
                                class="delete-btn">
                            ì‚­ì œ
                        </button>

                    </form>

                </div>

            </td>

        </tr>

        {% endfor %}

    </tbody>

</table>

<!-- ë¬¸ì˜ ìƒì„¸ ëª¨ë‹¬ -->
<div id="detailModal" class="modal" style="display:none;">
    <div class="modal-content">

        <span class="close" onclick="closeModal()">&times;</span>

        <h2>ğŸ“‹ ë¬¸ì˜ ìƒì„¸</h2>

        <p><strong>ì´ë¦„:</strong> <span id="modalName"></span></p>

        <p><strong>ì „í™”ë²ˆí˜¸:</strong>
            <a id="modalPhone" href=""></a>
        </p>

        <p><strong>ë‚´ìš©:</strong></p>
        <div id="modalMessage" class="modal-message"></div>

        <p><strong>ì‹œê°„:</strong> <span id="modalTime"></span></p>

        <div id="modalImageWrap"></div>

    </div>
</div>

<div id="chart-data"
     data-months='{{ months | tojson | safe }}'
     data-counts='{{ counts | tojson | safe }}'
     style="display:none;">
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const chartDataEl = document.getElementById("chart-data");

if (chartDataEl) {
    const months = JSON.parse(chartDataEl.dataset.months);
    const counts = JSON.parse(chartDataEl.dataset.counts);

    const ctx = document.getElementById("monthlyChart");

    if (ctx) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'ì›”ë³„ ë¬¸ì˜ ìˆ˜',
                    data: counts,
                    backgroundColor: '#1e3a8a'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
}

function toggleChart() {
    const area = document.getElementById("chartArea");
    area.style.display =
        area.style.display === "none" ? "block" : "none";
}

function showDetail(name, phone, message, time, image) {

    document.getElementById("modalName").innerText = name;

    const phoneEl = document.getElementById("modalPhone");
    phoneEl.innerText = phone;
    phoneEl.href = "tel:" + phone;

    document.getElementById("modalMessage").innerText = message;

    document.getElementById("modalTime").innerText = time;

    const imageWrap = document.getElementById("modalImageWrap");

    if (image && image !== "None") {

    const filename = image.split('/').pop();

    imageWrap.innerHTML =
        `<a href="${image}" target="_blank"
            style="
                display:inline-block;
                padding:8px 12px;
                background:#1e293b;
                color:#60a5fa;
                border-radius:8px;
                text-decoration:none;
                margin-top:10px;
            ">
            ğŸ“ ì²¨ë¶€íŒŒì¼ ë³´ê¸° (${filename})
        </a>`;

} else {
    imageWrap.innerHTML = "";
}


    document.getElementById("detailModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("detailModal").style.display = "none";
}

// ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const modal = document.getElementById("detailModal");
    if (event.target === modal) {
        modal.style.display = "none";
    }
}

function openImageViewer(src) {

    const viewer = document.getElementById("imageViewer");
    const img = document.getElementById("viewerImage");

    img.src = src;
    viewer.style.display = "flex";
}

function closeImageViewer() {
    document.getElementById("imageViewer").style.display = "none";
}

let zoomed = false;
let currentScale = 1;

/* ESC í‚¤ ë‹«ê¸° */
document.addEventListener("keydown", function(e){

    if(e.key === "Escape"){
        closeImageViewer();
    }

});

/* í´ë¦­ í™•ëŒ€ */
const viewerImg = document.getElementById("viewerImage");

if(viewerImg){

viewerImg.onclick = function(e){

    e.stopPropagation();

    zoomed = !zoomed;

    if(zoomed){
        this.classList.add("zoomed");
    }else{
        this.classList.remove("zoomed");
    }

};

}

/* ëª¨ë°”ì¼ pinch zoom */
let startDist = 0;

const viewerImageEl = document.getElementById("viewerImage");

if(viewerImageEl){

viewerImageEl.addEventListener("touchstart", function(e){

    if(e.touches.length === 2){

        startDist = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );

    }

});

viewerImageEl.addEventListener("touchmove", function(e){

    if(e.touches.length === 2){

        e.preventDefault();

        let newDist = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );

        let scale = newDist / startDist;

        this.style.transform = `scale(${scale})`;

    }

});

}

</script>

<script>

window.addEventListener("load", function(){

    document.querySelectorAll(".modal, .image-viewer").forEach(function(el){
        el.style.display = "none";
    });

});

</script>

<script>
document.querySelectorAll('.file-btn input').forEach(input => {

    input.addEventListener('change', function(){

        const name =
        this.files.length > 0 ?
        this.files[0].name :
        "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";

        this.closest('form')
        .querySelector('.file-name')
        .innerText = name;

    });

});
</script>

<script>

function openReplyPopup(id, reply){

    const popup = document.getElementById("replyPopup");

    popup.style.display = "flex";

    setTimeout(()=>{
        popup.classList.add("show");
    },10);

    document.getElementById("replyForm").action="/admin/reply/"+id;

    document.getElementById("replyInput").value=reply;

}

function closeReplyPopup(){

    const popup = document.getElementById("replyPopup");

    popup.classList.remove("show");

    setTimeout(()=>{
        popup.style.display="none";
    },250);

}

document.addEventListener("keydown", function(e){

    if(e.key === "Escape"){

        const popup = document.getElementById("replyPopup");

        if(popup.style.display === "flex"){
            closeReplyPopup();
        }

    }

});

document.getElementById("replyPopup").addEventListener("click", function(e){

    if(e.target === this){
        closeReplyPopup();
    }

});

const popupContent = document.getElementById("replyPopupContent");
const popupHeader = document.getElementById("popupHeader");

let isDragging = false;
let offsetX, offsetY;

popupHeader.addEventListener("mousedown", function(e){

    isDragging = true;

    offsetX = e.clientX - popupContent.offsetLeft;
    offsetY = e.clientY - popupContent.offsetTop;

    popupContent.style.position = "absolute";

});

document.addEventListener("mousemove", function(e){

    if(!isDragging) return;

    popupContent.style.left = (e.clientX - offsetX) + "px";
    popupContent.style.top = (e.clientY - offsetY) + "px";

});

document.addEventListener("mouseup", function(){

    isDragging = false;

});

let currentReplyId = null;
let currentReplyText = "";

function openReplyViewPopup(id, message, reply, file){

    currentReplyId = id;
    currentReplyText = reply;

    const popup = document.getElementById("replyViewPopup");

    if(!popup){
        console.error("replyViewPopup not found");
        return;
    }

    const messageEl = document.getElementById("viewMessage");
    const replyEl = document.getElementById("viewReply");
    const fileEl = document.getElementById("viewFile");
    const viewMode = document.getElementById("replyViewMode");
    const editForm = document.getElementById("replyEditForm");

    if(messageEl) messageEl.innerText = message;
    if(replyEl) replyEl.innerText = reply;

    if(file && file !== "None" && fileEl){

        const filename = file.split('/').pop();

        fileEl.innerHTML =
        `<a href="${file}" target="_blank"
            style="
            display:inline-block;
            padding:8px 12px;
            background:#1e293b;
            border-radius:8px;
            color:#60a5fa;
            text-decoration:none;
            border:1px solid var(--border);
        ">
        ğŸ“ ${filename}
        </a>`;
    }
    else if(fileEl){
        fileEl.innerHTML="";
    }

    // ëª¨ë“œ ì´ˆê¸°í™” (null ì²´í¬ í¬í•¨)
    if(viewMode) viewMode.style.display="block";
    if(editForm) editForm.style.display="none";

    // íŒì—… ì—´ê¸°
    popup.style.display="flex";
}

function closeReplyViewPopup(){

    const popup = document.getElementById("replyViewPopup");

    if(popup){
        popup.style.display="none";
    }
}

function editReplyFromView(){

    enableReplyEditMode();

}

// ìˆ˜ì • ì™„ë£Œ íŒì—… ì—´ê¸°
function showReplySuccessPopup(){

    const popup =
    document.getElementById("replySuccessPopup");

    popup.style.display="flex";

}

// ìˆ˜ì • ì™„ë£Œ íŒì—… ë‹«ê¸°
function closeReplySuccessPopup(){

    const popup =
    document.getElementById("replySuccessPopup");

    popup.style.display="none";

    location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ë³€ê²½ ë°˜ì˜
}


// replyForm submit í›„ ì„±ê³µ ì‹œ íŒì—… í‘œì‹œ
document.getElementById("replyForm")
.addEventListener("submit", function(){

    setTimeout(function(){

        showReplySuccessPopup();

    },500);

});

function enableReplyEditMode(){

    // ë³´ê¸° ìˆ¨ê¹€
    document.getElementById("replyViewMode").style.display="none";

    // ìˆ˜ì •í¼ í‘œì‹œ
    document.getElementById("replyEditForm").style.display="block";

    // ê¸°ì¡´ ë‹µë³€ ì±„ìš°ê¸°
    document.getElementById("replyEditInput").value =
        currentReplyText;

    // form action ì„¤ì •
    document.getElementById("replyEditForm").action =
        "/admin/reply/" + currentReplyId;
}

function deleteInquiry(id, form){

    if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    fetch("/delete/" + id, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        }
    })
    .then(res => {

        if(res.ok){

            // í–‰ ì¦‰ì‹œ ì œê±° (ë”œë ˆì´ ì—†ìŒ)
            form.closest("tr").remove();

        }else{

            alert("ì‚­ì œ ì‹¤íŒ¨");

        }

    });

}

</script>

<!-- ì´ë¯¸ì§€ ì „ì²´í™”ë©´ ë³´ê¸° -->
<div id="imageViewer" class="image-viewer" onclick="closeImageViewer()" style="display:none;">
    <span class="image-close">&times;</span>
    <img id="viewerImage">
</div>

<div id="replyPopup" class="popup">

    <div class="popup-content" id="replyPopupContent">

        <div id="popupHeader" style="
        cursor:move;
        font-weight:bold;
        margin-bottom:12px;
        padding-bottom:8px;
        border-bottom:1px solid var(--border);
        ">
        ğŸ“‹ ë‹µë³€ ì‘ì„± (ë“œë˜ê·¸ ê°€ëŠ¥)
        </div>

        <form id="replyForm"
              method="POST"
              enctype="multipart/form-data">

            <input type="text"
                   name="reply"
                   id="replyInput"
                   placeholder="ë‹µë³€ ì…ë ¥"
                   required>

            <br><br>

            <input type="file"
                   name="reply_file">

            <br><br>

            <button type="submit">
                ë‹µë³€ ì œì¶œ
            </button>

            <button type="button"
                    onclick="closeReplyPopup()">
                ì·¨ì†Œ
            </button>

        </form>

    </div>

</div>

<div id="replyViewPopup" class="reply-view-popup">

    <div class="reply-view-box">

        <div class="reply-view-title">
            ğŸ“‹ ë¬¸ì˜ ë‚´ìš©
        </div>

        <div id="viewMessage" class="reply-view-content"></div>

        <div class="reply-view-title">
            ğŸ’¬ ê´€ë¦¬ì ë‹µë³€
        </div>

        <!-- ë³´ê¸° ëª¨ë“œ -->
        <div id="replyViewMode">

            <div id="viewReply" class="reply-view-content"></div>

            <div id="viewFile" class="reply-view-file"></div>

        </div>

        <!-- ìˆ˜ì • ëª¨ë“œ -->
        <form id="replyEditForm"
              method="POST"
              enctype="multipart/form-data"
              style="display:none;">

            <textarea name="reply"
                      id="replyEditInput"
                      style="
                      width:100%;
                      height:80px;
                      background:#0f172a;
                      color:white;
                      border:1px solid var(--border);
                      border-radius:8px;
                      padding:8px;
                      margin-bottom:10px;
                      "></textarea>

            <input type="file"
                   name="reply_file"
                   style="margin-bottom:10px;">

            <button type="submit"
                    class="reply-btn">
                ìˆ˜ì • ì™„ë£Œ
            </button>

        </form>

        <div class="reply-view-buttons">

            <button onclick="event.stopPropagation(); enableReplyEditMode()" class="edit-btn">
                âœ ìˆ˜ì •
            </button>

            <button onclick="closeReplyViewPopup()" class="delete-btn">
                ë‹«ê¸°
            </button>

        </div>

    </div>

</div>

</body>
</html>
