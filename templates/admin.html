<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì í˜ì´ì§€</title>

<hr>

<style>
body { 
     background:linear-gradient(135deg,#f8fafc,#eef2ff);
}

.logo {
    text-align:center;
    margin-bottom:20px;
}

.logo img {
    height:70px;
}

.export-btn {
    background:#10b981;
    color:white;
    padding:10px 18px;
    border-radius:10px;
    text-decoration:none;
    font-weight:600;
    margin-right:10px;
}

.export-btn:hover {
    background:#059669;
}


.admin-table {
    border-radius:20px;
    overflow:hidden;
    box-shadow:0 12px 30px rgba(0,0,0,0.05);
}

.delete-btn {
    background:#ef4444;
    border:none;
    padding:8px 16px;
    border-radius:30px;
    font-weight:600;
    transition:0.2s;
}

.delete-btn:hover {
    background:#dc2626;
    transform:translateY(-2px);
}

.thumb {
    width:70px;
    height:70px;
    object-fit:cover;
    border-radius:14px;
    transition:0.3s;
}

.thumb:hover {
    transform:scale(1.1);
    box-shadow:0 8px 18px rgba(0,0,0,0.15);
}

.card {
    background:linear-gradient(135deg,#4f46e5,#6366f1);
    color:white;
    padding:25px;
    border-radius:18px;
    box-shadow:0 10px 25px rgba(79,70,229,0.25);
}
.card h3 {
    font-size:14px;
    opacity:0.9;
}
.card p {
    font-size:30px;
}

.top-section {
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:white;
    padding:20px 30px;
    border-radius:16px;
    box-shadow:0 8px 20px rgba(0,0,0,0.05);
    margin-bottom:25px;
}

.top-section h1 {
    margin:0;
    font-size:22px;
}

.sub {
    font-size:13px;
    color:#888;
    margin-top:4px;
}

.admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        .admin-table th {
            background: #3b4a8a;
            color: white;
            padding: 14px;
            text-align: center;
        }

        .admin-table td {
            padding: 14px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .admin-table tr:hover {
            background: #f5f7ff;
        }

        .thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .phone {
            color: #2e7d32;
            font-weight: 600;
            text-decoration: none;
        }

        .delete-btn {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .message {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .time {
            font-size: 13px;
            color: #666;
        }

.stats-wrapper {
    margin: 30px 0;
}

.toggle-btn {
    background: #3b4a8a;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
}

.toggle-btn:hover {
    background: #2f3b6e;
}

.stats-box {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fc;
    border-radius: 15px;
}

button {
    background: #ef4444;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    cursor: pointer;
}

button:hover {
    background: #dc2626;
}

.top-bar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.logout-btn {
    background:#1e293b;
    color:white;
    padding:8px 18px;
    border-radius:20px;
    text-decoration:none;
    font-weight:500;
}

.logout-btn:hover {
    background:#334155;
}

/* ê¸°ë³¸ í…Œì´ë¸” */
table {
    width: 100%;
    max-width: 1000px;
    margin: 30px auto;
    border-collapse: collapse;
    background: white;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    font-size: 14px;
}

th {
    background: #1e3a8a;
    color: white;
    padding: 14px;
    font-weight: 600;
}

td {
    padding: 14px;
    border-bottom: 1px solid #f0f0f0;
}

tr:hover {
    background: #f8fafc;
}

img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 10px;
}

a.call { 
    color:green; 
    font-weight:bold; 
    text-decoration:none; 
}

a.delete { 
    color:red; 
    font-weight:bold;
    text-decoration:none; 
}

/* ========================= */
/* ğŸ“± ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
/* ========================= */

@media (max-width: 768px) {

    body {
        padding:10px;
    }

    table, thead, tbody, th, td, tr {
        display:block;
    }

    thead {
        display:none;
    }

    tr {
        background:white;
        margin-bottom:15px;
        padding:10px;
        border-radius:10px;
        box-shadow:0 3px 10px rgba(0,0,0,0.08);
    }

    td {
        border:none;
        text-align:left;
        padding:6px 0;
        font-size:14px;
    }

    td::before {
        font-weight:bold;
        display:block;
        color:#1e3a8a;
    }

    td:nth-of-type(1)::before { content:"ì´ë¦„"; }
    td:nth-of-type(2)::before { content:"ì „í™”ë²ˆí˜¸"; }
    td:nth-of-type(3)::before { content:"ë‚´ìš©"; }
    td:nth-of-type(4)::before { content:"ì‚¬ì§„"; }
    td:nth-of-type(5)::before { content:"ì‹œê°„"; }
    td:nth-of-type(6)::before { content:"ê´€ë¦¬"; }


    a.call {
        display:inline-block;
        background:#22c55e;
        color:white;
        padding:6px 10px;
        border-radius:6px;
        margin-top:4px;
    }

    a.delete {
        display:inline-block;
        background:#ef4444;
        color:white;
        padding:6px 10px;
        border-radius:6px;
        margin-top:4px;
    }
}

.stats {
    display:flex;
    gap:20px;
    margin-bottom:20px;
}

.card {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
    text-align:center;
}
.card h3 {
    margin:0;
    font-size:16px;
}
.card p {
    font-size:24px;
    font-weight:bold;
    margin:10px 0 0;
}
.chart-wrapper {
    max-width: 1000px;
    margin: 20px auto;
}

.toggle-btn {
    background:#1e3a8a;
    color:white;
    padding:10px 18px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:500;
}

.toggle-btn:hover {
    background:#16327a;
}

.chart-box {
    margin-top:20px;
    background:white;
    padding:20px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

.modal {
    display:none;
    position:fixed;
    z-index:999;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.4);
}

.modal-content {
    background:white;
    margin:5% auto;
    padding:25px;
    width:90%;
    max-width:500px;
    border-radius:14px;
    position:relative;
    max-height:80vh;
    overflow:auto;
}

.close {
    position:absolute;
    right:15px;
    top:10px;
    font-size:22px;
    cursor:pointer;
}

.modal-message {
    background:#f8fafc;
    padding:12px;
    border-radius:8px;
    white-space:pre-wrap;
}

/* ===== stats ì¹´ë“œ ì¤‘ì•™ì •ë ¬ + ìƒ‰ìƒ ìˆ˜ì • ===== */

.stats {
    display: flex;
    justify-content: center;   /* ì „ì²´ ì¤‘ì•™ */
    align-items: center;
    gap: 20px;
    margin: 30px auto;
}

/* stat ì¹´ë“œ */
.stat-card {
    width: 160px;
    height: 110px;

    display: flex;
    flex-direction: column;

    justify-content: center;   /* ì„¸ë¡œ ì¤‘ì•™ */
    align-items: center;       /* ê°€ë¡œ ì¤‘ì•™ */

    text-align: center;

    background: white;
    border-radius: 14px;

    box-shadow: 0 6px 18px rgba(0,0,0,0.06);

    color: #334155; /* ê¸€ì ê¸°ë³¸ ìƒ‰ */
}

/* ìˆ«ì */
.stat-card .number {
    font-size: 28px;
    font-weight: bold;
    color: #1e3a8a;   /* ì§„í•œ íŒŒë‘ */
    margin-top: 5px;
}

/* ì•„ì´ì½˜ í¬í•¨ ì œëª© */
.stat-card div:first-child {
    font-size: 14px;
    color: #64748b;
}

/* ì „ì²´ í™”ë©´ ì´ë¯¸ì§€ ë·°ì–´ */
.image-viewer {
    display:none;
    position:fixed;
    z-index:2000;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);

    justify-content:center;
    align-items:center;
}

/* í™•ëŒ€ ì• ë‹ˆë©”ì´ì…˜ */
.image-viewer img {
    transition: transform 0.25s ease;
    cursor: zoom-in;
}

.image-viewer img.zoomed {
    transform: scale(2);
    cursor: zoom-out;
}

.image-viewer img {
    max-width:90%;
    max-height:90%;
    object-fit:contain;
    border-radius:10px;
}

.image-close {
    position:absolute;
    top:20px;
    right:30px;
    color:white;
    font-size:40px;
    cursor:pointer;
}

</style>
</head>

<body>

<div class="logo-wrap">
    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ê±´ì§„ì°½í˜¸ ë¡œê³ ">
</div>

<h2>í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì§„ ì—…ë¡œë“œ</h2>

<form action="/admin/upload_portfolio"
      method="POST"
      enctype="multipart/form-data">

    <input type="file" name="image" required>
    <button type="submit">ì‚¬ì§„ ì—…ë¡œë“œ</button>

</form>

<hr>

<div class="top-section">
    <div>
        <h1>ğŸ“‹ ë¬¸ì˜ ê´€ë¦¬</h1>

        <p class="sub">ìµœê·¼ ì ‘ìˆ˜ëœ ë¬¸ì˜ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
</div>

<div class="stats">

    <div class="stat-card">
        <div>ğŸ“¬ ì „ì²´ ë¬¸ì˜</div>
        <div class="number">{{ total_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“… ì˜¤ëŠ˜ ë¬¸ì˜</div>
        <div class="number">{{ today_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“Š ì´ë²ˆë‹¬ ë¬¸ì˜</div>
        <div class="number">{{ month_count }}</div>
    </div>

    <div class="stat-card">
        <div>ğŸ“¸ ì‚¬ì§„ í¬í•¨</div>
        <div class="number">{{ image_count }}</div>
    </div>

</div>

<div class="chart-wrapper">
    <button class="toggle-btn" onclick="toggleChart()">
        ğŸ“Š ì›”ë³„ í†µê³„ ë³´ê¸°
    </button>

    <div id="chartArea" class="chart-box" style="display:none;">
        <canvas id="monthlyChart"></canvas>
    </div>
    <a href="/export" class="export-btn">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
</div>

<script>
function toggleStats() {
    const box = document.getElementById("statsBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}
</script>

<table class="admin-table">
    <thead>
        <tr>
            <th>ì´ë¦„</th>
            <th>ì „í™”ë²ˆí˜¸</th>
            <th>ë‚´ìš©</th>
            <th>ì‚¬ì§„</th>
            <th>ì‹œê°„</th>
            <th>ê´€ë¦¬</th>
        </tr>
    </thead>
    <tbody>
         {% for i in inquiries %}
        <tr onclick="showDetail(
             '{{ i[1] }}',
             '{{ i[2] }}',
             `{{ i[3] }}`,
             '{{ i[4] }}',
             '{{ i[5] }}'
        )">
            <td>{{ i[1] }}</td>

            <td>
                <a href="tel:{{ i[2] }}" class="phone">
                    {{ i[2] }}
                </a>
            </td>

            <td class="message">{{ i[3] }}</td>

            <td>
                 {% if i[5] %}
                     <a href="{{ i[5] }}" target="_blank">
                         <img src="{{ i[5] }}" class="thumb">
                     </a>
                 {% else %}
                     -
                  {% endif %}
             </td>


            <td class="time">
                {{ i[4] }}
            </td>

            <td>
                <form action="/delete/{{ i[0] }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button class="delete-btn" 
                            onclick="event.stopPropagation()">
                        ì‚­ì œ
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ë¬¸ì˜ ìƒì„¸ ëª¨ë‹¬ -->
<div id="detailModal" class="modal">
    <div class="modal-content">

        <span class="close" onclick="closeModal()">&times;</span>

        <h2>ğŸ“‹ ë¬¸ì˜ ìƒì„¸</h2>

        <p><strong>ì´ë¦„:</strong> <span id="modalName"></span></p>

        <p><strong>ì „í™”ë²ˆí˜¸:</strong>
            <a id="modalPhone" href=""></a>
        </p>

        <p><strong>ë‚´ìš©:</strong></p>
        <div id="modalMessage" class="modal-message"></div>

        <p><strong>ì‹œê°„:</strong> <span id="modalTime"></span></p>

        <div id="modalImageWrap"></div>

    </div>
</div>

<div id="chart-data"
     data-months='{{ months | tojson | safe }}'
     data-counts='{{ counts | tojson | safe }}'
     style="display:none;">
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const chartDataEl = document.getElementById("chart-data");

if (chartDataEl) {
    const months = JSON.parse(chartDataEl.dataset.months);
    const counts = JSON.parse(chartDataEl.dataset.counts);

    const ctx = document.getElementById("monthlyChart");

    if (ctx) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'ì›”ë³„ ë¬¸ì˜ ìˆ˜',
                    data: counts,
                    backgroundColor: '#1e3a8a'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
}

function toggleChart() {
    const area = document.getElementById("chartArea");
    area.style.display =
        area.style.display === "none" ? "block" : "none";
}

function showDetail(name, phone, message, time, image) {

    document.getElementById("modalName").innerText = name;

    const phoneEl = document.getElementById("modalPhone");
    phoneEl.innerText = phone;
    phoneEl.href = "tel:" + phone;

    document.getElementById("modalMessage").innerText = message;

    document.getElementById("modalTime").innerText = time;

    const imageWrap = document.getElementById("modalImageWrap");

    if (image && image !== "None") {
        imageWrap.innerHTML =
             `<img src="${image}" 
                 onclick="openImageViewer('${image}')"
                 style="
                     width:100%;
                     max-height:400px;
                     object-fit:contain;
                     border-radius:10px;
                     margin-top:10px;
                     cursor:pointer;
                 ">`;

    } else {
        imageWrap.innerHTML = "";
    }

    document.getElementById("detailModal").style.display = "block";
}

function closeModal() {
    document.getElementById("detailModal").style.display = "none";
}

// ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const modal = document.getElementById("detailModal");
    if (event.target === modal) {
        modal.style.display = "none";
    }
}

function openImageViewer(src) {

    const viewer = document.getElementById("imageViewer");
    const img = document.getElementById("viewerImage");

    img.src = src;
    viewer.style.display = "flex";
}

function closeImageViewer() {
    document.getElementById("imageViewer").style.display = "none";
}

let zoomed = false;
let currentScale = 1;

/* ESC í‚¤ ë‹«ê¸° */
document.addEventListener("keydown", function(e){

    if(e.key === "Escape"){
        closeImageViewer();
    }

});

/* í´ë¦­ í™•ëŒ€ */
document.getElementById("viewerImage").onclick = function(e){

    e.stopPropagation();

    zoomed = !zoomed;

    if(zoomed){
        this.classList.add("zoomed");
        currentScale = 2;
    }else{
        this.classList.remove("zoomed");
        currentScale = 1;
    }

};

/* ëª¨ë°”ì¼ pinch zoom */
let startDist = 0;

document.getElementById("viewerImage")
.addEventListener("touchstart", function(e){

    if(e.touches.length === 2){

        startDist = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );

    }

});

document.getElementById("viewerImage")
.addEventListener("touchmove", function(e){

    if(e.touches.length === 2){

        e.preventDefault();

        let newDist = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );

        let scale = newDist / startDist;

        this.style.transform = `scale(${scale})`;

    }

});

</script>

<!-- ì´ë¯¸ì§€ ì „ì²´í™”ë©´ ë³´ê¸° -->
<div id="imageViewer" class="image-viewer" onclick="closeImageViewer()">
    <span class="image-close">&times;</span>
    <img id="viewerImage">
</div>

</body>
</html>
